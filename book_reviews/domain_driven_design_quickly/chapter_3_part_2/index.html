
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Chapter 3 (Part 2) - The Warren</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-3-part-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="The Warren" class="md-header-nav__button md-logo" aria-label="The Warren">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            The Warren
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Chapter 3 (Part 2)
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="The Warren" class="md-nav__button md-logo" aria-label="The Warren">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    The Warren
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Writings
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Writings" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Writings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" >
      
      <label class="md-nav__link" for="nav-2-1">
        Book Reviews/Discussion
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Book Reviews/Discussion" data-md-level="2">
        <label class="md-nav__title" for="nav-2-1">
          <span class="md-nav__icon md-icon"></span>
          Book Reviews/Discussion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Domain Driven Design Quickly
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_musings/" class="md-nav__link">
        Other Musings
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        About Me
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregates-factories-and-repositories" class="md-nav__link">
    Aggregates, Factories, and Repositories
  </a>
  
    <nav class="md-nav" aria-label="Aggregates, Factories, and Repositories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregates" class="md-nav__link">
    Aggregates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factories" class="md-nav__link">
    Factories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    Repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="chapter-3-part-2">Chapter 3 (Part 2)</h1>
<h2 id="modules">Modules</h2>
<p>Modules are an important factor in domain driven design - creating Modules that are well designed and cohesive is a large step towards writing clear and maintainable code. The parts of a Module should attempt to follow the idea of <em><a href="https://softwareengineering.stackexchange.com/questions/402593/concept-of-functional-cohesion" title="Stack Exchange post about functional cohesion in software">functional cohesion</a></em>. Ensure you are considering how tightly coupled the Modules are with themselves and the rest of the application. A low level of coupling is something to work towards; this can also make the move to microservies much easier at a later date if so desired. An important piece of advice the author recommends is to </p>
<blockquote>
<p>the Modules names that become part of the Ubiquitous Language. Modules and their names should reflect insight into the domain.</p>
</blockquote>
<p>For examples of tight versus loose coupling, think of the API of a bank. If the banks software is written for only one front end or client (in the programming sense, not the business sense), then we can consider the backend and frontend of that API <em>tightly coupled</em>. Now the bank has decided to let customers pull their own data about their accounts - this will require a redesign of the API of the backend in order to allow connections from different users, not just the single integrated front end. We can now say the system is <em>loosely coupled</em>. </p>
<h2 id="aggregates-factories-and-repositories">Aggregates, Factories, and Repositories</h2>
<h3 id="aggregates">Aggregates</h3>
<p>The last three parts of Chapter 3 cover the life cycle of domain objects. Objects in your application will be created, used throughout the application, and then destroyed when they are no longer needed. These three concepts help to establish some of the aspects of that cycle. Aggregates are </p>
<blockquote>
<p>a group of associated objects which are considered as one unit with regard to data changes.</p>
</blockquote>
<p>Each Aggregate has exactly one root. The root of the Aggregate is an Entity; the Entity is the only publicly accessible object of the Aggreggate. Internal objects inside the Aggregate can hold references to other internal objects or Entities that are entirely internal to the Aggregate. Nothing outside of the boundary of the Aggregate should hold a reference to anything except the root of the Aggregate. For example, with a customer object at the root of the Aggregate, there could be internal references to a contact info object, address object, or a spouse object. If an external object needs that information, the root of the Aggregate could pass a <em><a href="https://stackoverflow.com/questions/57009765/c-references-and-transient-objects" title="Stack Overflow post about transient references in C++">transient reference</a></em> to the internal object, often in the form of a Value Object. </p>
<h3 id="factories">Factories</h3>
<p>A Factory is exactly what it sounds like - a mechanism to create <em>complex</em> objects. In order to create complex objects without a Factory, the calling object would often need to have intimate knowledge about the object it is attempting to create. This breaks multiple principles of DDD (and <a href="https://www.freecodecamp.org/news/object-oriented-programming-concepts-21bb035f7260/" title="Freecodecamp article about OOP principles">Object Oriented Programming principles</a>). An important part of this object creation is <em><a href="https://cs.stackexchange.com/questions/109248/whats-exact-definition-of-atomicity-in-programming" title="Stack Exchange post about atomicity with some great answers">atomicity</a></em>. Specifically, there should never be a half-created object, only no object or a whole object. The Aggregate should have a method that utilizes the Factory to create the objects that make up the Aggregate. This creation process will enforce the <em><a href="https://softwareengineering.stackexchange.com/questions/32727/what-are-invariants-how-can-they-be-used-and-have-you-ever-used-it-in-your-pro" title="Stack Exchange post with some good answers about invariants">invariants</a></em> of the different objects to ensure that the resulting object is valid. While it is true that Factories are tightly coupled to the objects they create, this can be a strength in that it gives you a single place to concentrate your creation logic. Sometimes, a simple constructor is enough; use a constructor when:</p>
<blockquote>
<ul>
<li>The construction is not complicated.</li>
<li>The creation of an object does not involve the creation of others, and all the attributes needed are passed via the constructor.</li>
<li>The client is interested in the implementation, perhaps wants to choose the Strategy used.</li>
<li>The class is the type. There is no hierarchy involved, so no need to choose between a list of concrete implementations.</li>
</ul>
</blockquote>
<p>In order to retain Entity integrity, ensure that any violation of an invariant returns an exception. When creating an object from the database, if there is a violation of an invariant, that violation must be repaired before being used to generate the object. For example, if another process has added a number to a string in the database that should be restricted to only alpha characters, this should be resolved before creating that object (this is a fairly contrived example, but hopefully you get the picture). </p>
<h3 id="repositories">Repositories</h3>
<p>The hypothetical scenario presented by the author to explain the need for Repositories is this: if a client needs to obtain the reference to an Aggregate, it needs a reference to the root of that aggregate. While this can be obtained by <em><a href="https://domaindrivendesign.yahoogroups.narkive.com/tHLZeQz4/what-are-traversable-associations-and-traversal-directions" title="A Yahoo group thread about DDD and association traversal">assocatiation traversal</a></em>, this sometimes forces object to hold references they would not normally hold. Another common way to make this happen is to let the client pull the Entity directly from the database; this is generally a bad idea as it requires the clients or the objects the clients request to be aware of how to access the database. What if you change the underlying infrastructure or database? Now all of that scattered code must be changed as well.</p>
<p>In order to alleviate these concerns, the author introduces the Repository pattern. </p>
<blockquote>
<p>The Repository may store references to some of the objects. When an object is created, it may be saved in the Repository, and retrieved from there to be used later. If the client requested an object from the Repository, and the Repository does not have it, it may get it from the storage. Either way, the Repository acts as a storage place for globally accessible objects.</p>
</blockquote>
<p>Many applications use a <em><a href="https://dzone.com/articles/introducing-amp-assimilating-caching-quick-read-fo" title="A great article about the many different types of caching">caching system</a></em> to serve the role of the repository. Caches give the application easy and <em>quick</em> access to the different objects generated by the Factories. Repositories should also be able to request an object be created by a Factory. The Repository can be likened to infrastructure, but it should remain purely in the domain. It should have <em>links</em> to the infrastructure layer in order to obtain objects from the database if needed; it should not, however, be tightly coupled to the infrastructure.</p>
<p>Check out the next couple <a href="../chapters_4_and_5/" title="Review of chapters 4 and 5 of DDDQ">chapters here!</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../../../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>